import{_ as i,c as a,o as h,ag as n}from"./chunks/framework.DPDPlp3K.js";const r=JSON.parse('{"title":"HP39gii的一个带简单压缩算法的图像保存和加载库","description":"一个带简单压缩算法的图像保存和加载库","frontmatter":{"date":"2024-09-19T00:00:00.000Z","title":"HP39gii的一个带简单压缩算法的图像保存和加载库","category":"hp39gii","tags":["hp39gii"],"description":"一个带简单压缩算法的图像保存和加载库"},"headers":[],"relativePath":"posts/hp-calc/hp39gii/BLib.md","filePath":"posts/hp-calc/hp39gii/BLib.md"}'),k={name:"posts/hp-calc/hp39gii/BLib.md"};function p(l,s,t,F,E,e){return h(),a("div",null,s[0]||(s[0]=[n(`<p>::: Blib：一个带简单压缩算法的图像保存和加载库，可以将2bit色深的<code>灰度图像</code>保存为<code>字符编码</code>。</p><div class="info custom-block"><p class="custom-block-title">技术细节</p><p>使用两段文本区域分别保存<code>可压缩图像</code>和<code>不可压缩图像</code>，<code>可压缩图像</code>对应字符区域偏移量1000，不可压缩图像对应字符区域偏移量200； 图像保存顺序为水平扫描，每4像素为一组，不够4像素空位替代，每组需要2^4=16bit，正好是<code>hp39gii</code>的文本编码(Unicode 16)存储一个字符所需的位大小。 扫描过程中对于超过4像素的连续为一个颜色的像素条(连续的一列像素)，将保存为压缩格式，长度最长为64。 在读取时，对于<code>不可压缩图像</code>采用<code>PIXON_P</code>函数逐像素点绘制，对于<code>可压缩图像</code>采用<code>LINE_P</code>函数一次性绘制。</p><p>实测读取图像并绘制到屏幕上速度较快（<s>相比LsLib</s>）</p></div><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">EXPORT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> BLOAD</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">G,X,Y,d</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">BEGIN</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">LOCAL</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> D,Dl:=dim</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">d(3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)),N,I,Px:=X,Py:=Y,c,ch;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">//2021.12.10</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> BLOAD</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Grob,StartX,StartY,Data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">//d:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">={Width,Hight,Data}</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">FOR</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> D</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> FROM</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> TO</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Dl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DO</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    TRACE(asc(mid(d(3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),D,1)))►ch;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    IF</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ch≥1000</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> THEN</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        ch:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">=ch-1000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">N:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">=ch</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> MOD</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 64</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">c:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ch-N</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.015625;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        LINE_P(G,Px,Py,Px+N,Py,c</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    ELSE</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        ch:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">=ch-200</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        IF</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Px+3≥X+d</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">THEN</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            X+d(1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)-Px-1►N;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ELSE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 3►N</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">END</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        FOR</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> I</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> FROM</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> TO</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> N</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DO</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            ch</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> MOD4►c</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.25*(ch-c</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)►ch;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">PIXON_P(G,Px+I,Py,c</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        END</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    END</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    Px+N+1►Px</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    IF</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Px≥X+d</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">THEN</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Py+1►Py</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">X►Px</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">END</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">END</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">END</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">EXPORT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> BSAVE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">G,X,Y,W,H</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">BEGIN</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">//2021.12.8</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">//LINE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 1000Start</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 64Pix</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">//PIX</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 4Pix</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 4Color</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">LOCAL</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> N,I,Px,Py,c,ch:=&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">FOR</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Py</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> FROM</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Y</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> TO</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Y+H-1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DO</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    X►Px</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    WHILE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Px+1≤X+W</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DO</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        GETPIX_P(G,Px,Py</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)►c;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        FOR</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> N</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> FROM</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> TO</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 64</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DO</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            IF</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> GETPIX_P</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">G,Px+N,Py</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">≠c</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> OR</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Px+N≥X+W</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> OR</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> N=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">64</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> THEN</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            IF</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> N≤4</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> THEN</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                IF</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Px+N</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">X+W</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> THEN</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 4►N</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">END</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                FOR</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> I</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> FROM</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> TO</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> N-1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DO</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                    c:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">=c+4^I*GETPIX_P</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">G,Px+I,Py</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">END</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                ch:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">=ch+char</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">200+c</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                ELSE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ch:=ch+char</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">1000+64*c+N-1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">END</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            Px:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">=Px+N</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">BREAK</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            END</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">//IF</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        END</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">//N</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    END</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">//Px</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">END</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">//Py</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">RETURN</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> {W,H,ch}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">END</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">//</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">{32,32,</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;ӇҲϲұҰ϶үүϲƽƻҬҭĘĘЬҭƸćҬńƟҳƉćǇńҸÉćǇńҷÉǄćƧҷÉƸƗƿҷÉƈƗƿҸÍĸƻƧҹÉÈƻħŇҬǅƋÉÈƻçåŅĥƍϯƻçŅƋҬǄϮƻħćÔƸƻËÈƛŇƗҭƈËϭċҭǄүϱËǅćҲϰËƼćұϱËĘǁøҭϱËϬǅãҬϱ×ϬǅþǇƈϭË×ϭŅüÔÔϬËćϮÑƼÌϮ×ǇϯÉŅϭË×ǇϴÝÈËćҬϴÉøƸ×ҭϲÙÔƸćүϰËËҮҰϰËƸҭҲϲұ&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">}</span></span></code></pre></div><p>![[../files/BLib.txt]]</p>`,4)]))}const g=i(k,[["render",p]]);export{r as __pageData,g as default};
